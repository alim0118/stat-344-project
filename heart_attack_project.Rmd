---
title: "R Notebook"
output:
  pdf_document: default
  html_notebook: default
---

```{r}
# load data set
heartattack <- read.csv("heart_attack_prediction_dataset.csv", header=T)

# Our population of interest are people at risk of heart attack 
heartattack <- heartattack[heartattack$Heart.Attack.Risk == 1,]
head(heartattack)
```

Find recommended sample size for this study

```{r}
# calculate min sample size needed
pop_size <- nrow(heartattack) # 3139

# using 95% CI, find n for worst case scenario: p = 0.5
MOE <- 0.05
z <- 1.96
p_guess <- 0.5

# if N is large enough to ignore FPC
n_0 = ceiling( ((2*z)^2*(0.5)*(0.5)) / (MOE^2)) # 1537
# since we know N = 8763, using FPC
n = ceiling( n_0 / (1 + (n_0/pop_size)) ) # 1032

#Calculate within variance of each diet stratum: Average, Unhealthy, Healthy
variance_within_strata <- aggregate(BMI ~ Diet, heartattack, var)
colnames(variance_within_strata) <- c("Diet","Within Variance BMI")
variance_within_strata

#Get stratum sizes
average_statum_size <- nrow(heartattack[heartattack$Diet == "Average",])
healthy_stratum_size <- nrow(heartattack[heartattack$Diet == "Healthy",])
unhealthy_stratum_size <- nrow(heartattack[heartattack$Diet == "Unhealthy",])


#Sample size n_h proportional to N_h*S_pw^2/sqrt(cost)
#Ignore costs
total <- sum(average_statum_size*variance_within_strata$`Within Variance BMI`[1],
            healthy_stratum_size*variance_within_strata$`Within Variance BMI`[2],
            unhealthy_stratum_size*variance_within_strata$`Within Variance BMI`[3])

average_size_proportion <- average_statum_size*variance_within_strata$`Within Variance BMI`[1]/total
healthy_size_proportion <- healthy_stratum_size*variance_within_strata$`Within Variance BMI`[2]/total
unhealthy_size_proportion <- unhealthy_stratum_size*variance_within_strata$`Within Variance BMI`[3]/total

average_sample_size <- round(average_size_proportion*n)
healthy_sample_size <- round(healthy_size_proportion*n)
unhealthy_sample_size <- round(unhealthy_size_proportion*n)

```
Assuming the worst case proportions 0.5, the sample size used if we ignored FPC is `r n_0`.
Whereas including FPC the sample size used in SRS will be `r n`. In the three stratums:
Diet =: (Average,Healthy,Unhealthy), sample size for average is `r average_sample_size`,
sample size for Healthy is `r healthy_sample_size`, sample size for Unhealthy is `r unhealthy_sample_size`

```         
Selecting Samples through SRS and Stratification from diet
```

```{r}
# set seed
set.seed(2023)

# take SRS of n = 1308
SRS.index <- sample.int(pop_size, n, replace=F)
heartsample <- heartattack[SRS.index, ]
head(heartsample)


```

The 



Calculating Estimates
```{r}
#Calculate mean BMI from SRS

```

